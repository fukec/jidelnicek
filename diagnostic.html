<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß Diagnostika - Stravovac√≠ den√≠k</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding: 20px; font-family: 'Courier New', monospace; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        .info { background: #cce7ff; color: #004085; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 5px; max-height: 200px; overflow-y: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Diagnostika syst√©mu</h1>
        <p>Tento n√°stroj otestuje v≈°echny komponenty stravovac√≠ho den√≠ku</p>
        
        <button id="start-test" class="btn btn-primary">üöÄ Spustit diagnostiku</button>
        <button id="clear-results" class="btn btn-secondary">üóëÔ∏è Vymazat v√Ωsledky</button>
        
        <div id="results" class="mt-4">
            <!-- V√Ωsledky test≈Ø se zobraz√≠ zde -->
        </div>
    </div>

    <script>
        const CONFIG = {
            API_URL: '1ARwLf0cFVqiv2uFPnFQxXKe-wjtBitRGOP06IJhyDz98LB8x4X-C773l', // ‚ö†Ô∏è MUS√ç≈† NAHRADIT!
            TEST_CLIENT_KEY: 'diagnostic_test'
        };

        let resultsContainer;

        document.addEventListener('DOMContentLoaded', function() {
            resultsContainer = document.getElementById('results');
            
            document.getElementById('start-test').addEventListener('click', runDiagnostics);
            document.getElementById('clear-results').addEventListener('click', clearResults);
        });

        async function runDiagnostics() {
            clearResults();
            addResult('info', 'üöÄ Spou≈°t√≠m diagnostiku...', '');

            // Test 1: Konfigurace
            testConfiguration();

            // Test 2: GitHub Pages
            await testGitHubPages();

            // Test 3: API dostupnost
            await testAPIAvailability();

            // Test 4: POST funkƒçnost
            await testPOSTFunctionality();

            // Test 5: GET funkƒçnost  
            await testGETFunctionality();

            // Test 6: Admin endpoint
            await testAdminEndpoint();

            addResult('info', '‚úÖ Diagnostika dokonƒçena', new Date().toLocaleString('cs-CZ'));
        }

        function testConfiguration() {
            addResult('info', '1Ô∏è‚É£ Test konfigurace', '');

            if (CONFIG.API_URL === 'ZDE_VLOZ_SVUJ_APPS_SCRIPT_URL') {
                addResult('error', '‚ùå API_URL nen√≠ nakonfigurov√°no', 'Nastavte spr√°vn√© Apps Script URL v k√≥du');
                return;
            }

            if (!CONFIG.API_URL.includes('script.google.com')) {
                addResult('error', '‚ùå Neplatn√© API_URL', 'URL mus√≠ b√Ωt z script.google.com');
                return;
            }

            if (!CONFIG.API_URL.endsWith('/exec')) {
                addResult('warning', '‚ö†Ô∏è API_URL by mƒõlo konƒçit na /exec', CONFIG.API_URL);
            } else {
                addResult('success', '‚úÖ Konfigurace v po≈ô√°dku', CONFIG.API_URL);
            }
        }

        async function testGitHubPages() {
            addResult('info', '2Ô∏è‚É£ Test GitHub Pages', '');
            
            try {
                const currentURL = window.location.href;
                if (currentURL.includes('github.io')) {
                    addResult('success', '‚úÖ Bƒõ≈æ√≠ na GitHub Pages', currentURL);
                } else if (currentURL.includes('localhost') || currentURL.includes('127.0.0.1')) {
                    addResult('warning', '‚ö†Ô∏è Bƒõ≈æ√≠ lok√°lnƒõ', 'Pro produkci nasaƒète na GitHub Pages');
                } else {
                    addResult('info', 'üåê Bƒõ≈æ√≠ na vlastn√≠m hostingu', currentURL);
                }
            } catch (error) {
                addResult('error', '‚ùå Chyba p≈ôi testov√°n√≠ hostingu', error.message);
            }
        }

        async function testAPIAvailability() {
            addResult('info', '3Ô∏è‚É£ Test dostupnosti API', '');

            try {
                const startTime = performance.now();
                const response = await fetch(CONFIG.API_URL + '?test=ping', {
                    method: 'GET',
                    headers: { 'Cache-Control': 'no-cache' }
                });
                const endTime = performance.now();
                const responseTime = Math.round(endTime - startTime);

                if (response.ok) {
                    addResult('success', `‚úÖ API dostupn√© (${responseTime}ms)`, `Status: ${response.status}`);
                } else {
                    addResult('error', '‚ùå API nedostupn√©', `HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                addResult('error', '‚ùå Chyba p≈ôipojen√≠ k API', error.message);
            }
        }

        async function testPOSTFunctionality() {
            addResult('info', '4Ô∏è‚É£ Test POST (ukl√°d√°n√≠ dat)', '');

            const testData = {
                klient_klic: CONFIG.TEST_CLIENT_KEY,
                items: [{
                    datum: new Date().toISOString().split('T')[0],
                    druh_chodu: 'Testovac√≠ chod',
                    hmotnost: 100,
                    potravina: 'Testovac√≠ potravina',
                    kaloricka_hodnota: 200
                }]
            };

            try {
                const response = await fetch(CONFIG.API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(testData)
                });

                const result = await response.json();

                if (result.success) {
                    addResult('success', '‚úÖ POST funkƒçn√≠', `Ulo≈æeno ${testData.items.length} polo≈æek`);
                } else {
                    addResult('error', '‚ùå POST selhalo', result.error || 'Nezn√°m√° chyba');
                }
            } catch (error) {
                addResult('error', '‚ùå Chyba POST po≈æadavku', error.message);
            }
        }

        async function testGETFunctionality() {
            addResult('info', '5Ô∏è‚É£ Test GET (naƒç√≠t√°n√≠ dat klienta)', '');

            try {
                const response = await fetch(`${CONFIG.API_URL}?key=${CONFIG.TEST_CLIENT_KEY}&days=7`);
                const result = await response.json();

                if (result.success) {
                    const dataCount = result.data ? result.data.length : 0;
                    addResult('success', '‚úÖ GET funkƒçn√≠', `Naƒçteno ${dataCount} z√°znam≈Ø`);
                    
                    if (dataCount > 0 && result.data[0]) {
                        const sample = result.data[0];
                        addResult('info', 'üìã Uk√°zka dat', JSON.stringify(sample, null, 2));
                    }
                } else {
                    addResult('error', '‚ùå GET selhalo', result.error || 'Nezn√°m√° chyba');
                }
            } catch (error) {
                addResult('error', '‚ùå Chyba GET po≈æadavku', error.message);
            }
        }

        async function testAdminEndpoint() {
            addResult('info', '6Ô∏è‚É£ Test Admin endpoint', '');

            try {
                const response = await fetch(`${CONFIG.API_URL}?admin=1&client=${CONFIG.TEST_CLIENT_KEY}`);
                const result = await response.json();

                if (result.success) {
                    const dataCount = result.data ? result.data.length : 0;
                    addResult('success', '‚úÖ Admin endpoint funkƒçn√≠', `Naƒçteno ${dataCount} admin z√°znam≈Ø`);
                } else {
                    addResult('error', '‚ùå Admin endpoint selhalo', result.error || 'Nezn√°m√° chyba');
                }
            } catch (error) {
                addResult('error', '‚ùå Chyba admin po≈æadavku', error.message);
            }
        }

        function addResult(type, title, details) {
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            
            let content = `<strong>${title}</strong>`;
            if (details) {
                if (typeof details === 'object') {
                    content += `<pre>${JSON.stringify(details, null, 2)}</pre>`;
                } else {
                    content += `<br><small>${details}</small>`;
                }
            }
            
            div.innerHTML = content;
            resultsContainer.appendChild(div);
            
            // Auto scroll
            div.scrollIntoView({ behavior: 'smooth' });
        }

        function clearResults() {
            resultsContainer.innerHTML = '';
        }
    </script>
</body>
</html>
